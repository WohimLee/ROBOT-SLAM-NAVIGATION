&emsp;
# AMCL

ros-navigation 系统采用了一种比 SLAM 定位更轻量级的方案 —— AMCL（Adaptive Monte Carlo Localization，自适应蒙特卡洛定位）。

>AMCL 代码实现
- AMCL 包含两种代码实现：
    - 用于二维地图定位的代码实现 amcl
    - 用于三维地图定位的代码实现 amcl3d

    其中 ros-navigation 默认集成了二维地图定位的 amcl 代码包

&emsp;
## 1 状态估计问题

>单独定位与 SLAM
- 单独定位问题：$P(\pmb{x}_k | \pmb{Z}_{0:k}，\pmb{U}_{0:k}，\pmb{m})$
- $SLAM$ 问题：$P(\pmb{x}_k，\pmb{m} | \pmb{Z}_{0:k}，\pmb{U}_{0:k}，\pmb{x}_0)$

    单独定位问题比 SLAM 问题要简单，因为：
    - 单独定位问题是在环境地图 $\pmb{m}$ 已知的情况下估计机器人位姿 $\pmb{x}_k$
    - 而 SLAM 问题是在地图 $\pmb{m}$ 未知的情况下同时估计机器人位姿 $\pmb{x}_k$ 和地图 $\pmb{m}$。

    不过，当 SLAM 载入已建好的地图时，可以认为 SLAM 重定位模式等价于单独定位问题。从某种意义上说，AMCL 定位在原理上与 Gmapping 重定位模式是等价的，虽然 Gmapping 中并没有单独设置重定位模式。

&emsp;
>状态估计问题
- 无论是 SLAM 问题还是单独定位问题都属于状态估计问题。对于单独定位问题来：
    - 随机变量：机器人位姿 $\pmb{x}_k$ 
    - 概率分布：求解定位问题其实就是求解随机变量 $\pmb{x}_k$ 的概率分布
    - 期望：最后以 $\pmb{x}_k$ 的期望作为机器人位姿的估计值

&emsp;
>状态估计的求解
- 贝叶斯估计方法是求解该状态估计的经典方法之一，另一种求解方法是优化方法。

    贝叶斯估计又可以分为：
    - 参数化实现：以卡尔曼滤波算法为代表
    - 非参数化实现：以粒子滤波算法为代表

    AMCL 是 CML（Monte Carlo Localization，蒙特卡洛定位）的改进版本，而 MCL 属于粒子滤波的范畴，因此 AMCL 也属于粒子滤波的范畴

&emsp;
## 2 蒙特卡洛
- 蒙特卡洛是一种将概率现象用统计试验方法进行数值模拟的思想

求解机器人定位问题的例子滤波算法是将机器人的待估计位姿量 $\pmb{x}_k$ 的概率密度（也叫置信度，即机器人出现在粒子点聚集的地方的置信度高），通过机器人观测方程和运动方程所提供的数据对粒子点的分布情况不断进行更新，使粒子点最终收敛于某个很小的区域。

更新粒子点分布的方法有很多，因此求解机器人定位问题的粒子滤波算法也有很多，例如：
- RBPF
- MCL
- AMCL

&emsp;
## 3 AMCL 对 MCL 的改进
与 BRPF 一样，MCL 也属于 SIR（Sampling Importance Resampling）滤波器的范畴。MCL 的原理也体现在重采样过程，也就是
- 利用观测方程和运动方程所提供的数据来评估当前每个粒子点的权重
- 然后依据每个离子电的权重进行重采样，以更新粒子点的分布

AMCL 对 MCL 做了两方面的改进：
- 一方面是将 MCL 中固定的粒子数量替换成了自适应的粒子数量
- 另一方面是增加了 MCL 遭遇绑架后的恢复策略

当粒子比较分散时，粒子点总数可以设得大一点；当粒子点比较聚集时，粒子点总数可以设得小一点，以减少计算量，提高运行效率。AMCL 中的粒子数量自适应有助于提高算法的运行效率，这在计算资源受限的机器中尤为重要。

>绑架问题
- 由于观测方程或者运动方程中的数据受噪声干扰或者某些偶然因素，原本表征机器人真实位姿的粒子点被丢弃了，以后的更新过程也只是错误粒子点的收敛。

    简单点说就是在某次更新中正确粒子点被意外丢弃后，机器人位姿将永久丢失，即机器人遭遇了绑架。

    AMCL 中引入了一个机制来监控绑架风险，以便在适当情况下启动恢复策略（即增加一些随机粒子点）

    对于在真实环境中持续运行的机器人来说，机器人遭遇绑架是必然的，因此 AMCL 中引入恢复策略非常必要
    







